<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>App.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">inkball_scaffold</a> &gt; <a href="index.source.html" class="el_package">inkball</a> &gt; <span class="el_source">App.java</span></div><h1>App.java</h1><pre class="source lang-java linenums">package inkball;

import processing.core.PApplet;
import processing.core.PConstants;
import processing.data.JSONArray;
import processing.data.JSONObject;

import java.util.*;

public class App extends PApplet {

    public static final int CELLSIZE = 32;
    public static final int CELLHEIGHT = 32;

    public static final int CELLAVG = 32;
    public static final int TOPBAR = 64;
<span class="fc" id="L17">    public static int WIDTH = 576;</span>
<span class="fc" id="L18">    public static int HEIGHT = 640;</span>
<span class="fc" id="L19">    public static final int BOARD_WIDTH = WIDTH / CELLSIZE;</span>
    public static final int BOARD_HEIGHT = 20;

    public static final int FPS = 30;

    ConfigReader configReader;
<span class="fc" id="L25">    boolean isPaused = false;</span>
<span class="fc" id="L26">    boolean isGameEnded = false;</span>
<span class="fc" id="L27">    int currentLevelIndex = 0;</span>
    int totalLevels;
    Level currentLevel;
<span class="fc" id="L30">    int score = 0; // Total score</span>

    public List&lt;Ball&gt; unspawnedBalls; // List of unspawned balls

    int spawnCounter;

<span class="fc" id="L36">    List&lt;PlayerDrawnLine&gt; playerLines = new ArrayList&lt;&gt;();</span>

    public String configPath;

<span class="fc" id="L40">    public static Random random = new Random();</span>

    // Timer-related variables
    int totalTime;       // Total time for the current level in seconds
    int remainingTime;   // Remaining time in seconds
    long startTime;      // Start time in milliseconds
    boolean timerFinished; // Indicates whether the timer has finished

<span class="fc" id="L48">    boolean levelEnded = false;</span>

    /**
     * Constructor to initialize the App with the config path.
     */
<span class="fc" id="L53">    public App() {</span>
<span class="fc" id="L54">        this.configPath = &quot;config.json&quot;;</span>
<span class="fc" id="L55">    }</span>

    /**
     * Initialize the settings for the window size.
     */
    @Override
    public void settings() {
<span class="fc" id="L62">        size(WIDTH, HEIGHT);</span>
<span class="fc" id="L63">    }</span>

    /**
     * Load all resources such as images, and initialize elements such as player and map elements.
     */
    @Override
    public void setup() {
<span class="fc" id="L70">        frameRate(FPS);</span>
<span class="fc" id="L71">        configReader = new ConfigReader(&quot;config.json&quot;, this);</span>
<span class="fc" id="L72">        totalLevels = configReader.getNumLevels();</span>
<span class="fc" id="L73">        loadLevel(currentLevelIndex);</span>
<span class="fc" id="L74">    }</span>

    /**
     * Load a specific level by its index and initialize balls and level layout.
     *
     * @param index the index of the level to load
     */
    public void loadLevel(int index) {
<span class="fc" id="L82">        JSONObject levelConfig = configReader.getLevelConfig(index);</span>
<span class="fc" id="L83">        JSONObject config = configReader.getConfig(); // Get the entire config object</span>
<span class="fc bfc" id="L84" title="All 2 branches covered.">        if (levelConfig != null) {</span>
<span class="fc" id="L85">            String layoutFile = levelConfig.getString(&quot;layout&quot;);</span>
<span class="fc" id="L86">            int levelTime = levelConfig.getInt(&quot;time&quot;);</span>
<span class="fc" id="L87">            int spawnInterval = levelConfig.getInt(&quot;spawn_interval&quot;);</span>
<span class="fc" id="L88">            spawnCounter = spawnInterval * App.FPS;</span>

            // Initialize the unspawnedBalls list
<span class="fc" id="L91">            unspawnedBalls = new ArrayList&lt;&gt;();</span>

            // Get ball colors for the current level
<span class="fc" id="L94">            JSONArray ballColors = configReader.getBallColors(index);</span>
<span class="fc bfc" id="L95" title="All 2 branches covered.">            for (int i = 0; i &lt; ballColors.size(); i++) {</span>
<span class="fc" id="L96">                String colorName = ballColors.getString(i);</span>
<span class="fc" id="L97">                int color = ColorUtils.colorToNumber(colorName);</span>
<span class="fc" id="L98">                int initialX = 10 + i * 30;</span>
<span class="fc" id="L99">                int initialY = 30;</span>
<span class="fc" id="L100">                Ball ball = new Ball(initialX, initialY, color, 12, this);</span>
<span class="fc" id="L101">                unspawnedBalls.add(ball);</span>
            }

            // Create a new Level instance, passing the levelConfig, config, and App instance
<span class="fc" id="L105">            currentLevel = new Level(index, configReader, this);</span>

            // Load the level layout
<span class="fc" id="L108">            currentLevel.loadLevel(layoutFile, this);</span>

            // Immediately spawn a new ball
<span class="fc" id="L111">            spawnNewBall();</span>

            // Initialize timer
<span class="fc" id="L114">            totalTime = levelTime; // Assuming getTimeLeft returns time in seconds</span>
<span class="fc" id="L115">            remainingTime = totalTime;</span>
<span class="fc" id="L116">            timerFinished = false;</span>
<span class="fc" id="L117">            startTime = System.currentTimeMillis();</span>

            // Reset game state for the new level
<span class="fc" id="L120">            levelEnded = false;</span>
<span class="fc" id="L121">            isGameEnded = false;</span>

<span class="fc" id="L123">            playerLines.clear();</span>
        }
<span class="fc" id="L125">    }</span>

    /**
     * Proceed to the next level or end the game if all levels are completed.
     */
    public void nextLevel() {
<span class="fc" id="L131">        currentLevelIndex++;</span>
<span class="fc bfc" id="L132" title="All 2 branches covered.">        if (currentLevelIndex &lt; totalLevels) {</span>
<span class="fc" id="L133">            loadLevel(currentLevelIndex);</span>
        } else {
<span class="fc" id="L135">            isGameEnded = true;</span>
<span class="fc" id="L136">            println(&quot;Congratulations! You've completed all levels.&quot;);</span>
        }
<span class="fc" id="L138">    }</span>

    /**
     * Add a ball back to the unspawned queue.
     *
     * @param ball the ball to be re-added to the queue
     */
    public void addUnspawnedBall(Ball ball) {
<span class="fc" id="L146">        ball.resetRadius();</span>
<span class="fc" id="L147">        ball.setX(20 + unspawnedBalls.size() * 30);</span>
<span class="fc" id="L148">        ball.setY(30);</span>
<span class="fc" id="L149">        unspawnedBalls.add(ball);</span>
<span class="fc" id="L150">    }</span>

    /**
     * Spawn a new ball at a random spawner location.
     */
    public void spawnNewBall() {
<span class="fc bfc" id="L156" title="All 2 branches covered.">        if (!unspawnedBalls.isEmpty()) {</span>
<span class="fc" id="L157">            Ball ball = unspawnedBalls.remove(0);</span>

            // Get a random spawner position
<span class="fc bfc" id="L160" title="All 2 branches covered.">            if (!currentLevel.getSpawners().isEmpty()) {</span>
<span class="fc" id="L161">                int randomIndex = random.nextInt(currentLevel.getSpawners().size());</span>
<span class="fc" id="L162">                Spawner spawner = currentLevel.getSpawners().get(randomIndex);</span>
<span class="fc" id="L163">                ball.setX(spawner.getX());</span>
<span class="fc" id="L164">                ball.setY(spawner.getY());</span>
            }

<span class="fc" id="L167">            ball.setIsActive(true);</span>
<span class="fc" id="L168">            ball.setXVelocity(ball.getRandomVelocity());</span>
<span class="fc" id="L169">            ball.setYVelocity(ball.getRandomVelocity());</span>
<span class="fc" id="L170">            currentLevel.addBall(ball);</span>
        }
<span class="fc" id="L172">    }</span>

    /**
     * Restart the current level.
     */
    public void restartLevel() {
<span class="fc" id="L178">        loadLevel(currentLevelIndex);</span>
<span class="fc" id="L179">        playerLines.clear();</span>
<span class="fc" id="L180">        score = 0; // Reset level score (optional)</span>
<span class="fc" id="L181">        println(&quot;Restarted current level: &quot; + currentLevelIndex);</span>
<span class="fc" id="L182">    }</span>

    /**
     * Restart the entire game from the first level.
     */
    public void restartGame() {
<span class="fc" id="L188">        currentLevelIndex = 0;</span>
<span class="fc" id="L189">        isGameEnded = false;</span>
<span class="fc" id="L190">        loadLevel(currentLevelIndex);</span>
<span class="fc" id="L191">        playerLines.clear();</span>
<span class="fc" id="L192">        score = 0;</span>
<span class="fc" id="L193">        println(&quot;Game restarted.&quot;);</span>
<span class="fc" id="L194">    }</span>

    /**
     * Toggle the pause state of the game.
     */
    public void togglePause() {
<span class="fc bfc" id="L200" title="All 2 branches covered.">        isPaused = !isPaused;</span>
<span class="fc bfc" id="L201" title="All 2 branches covered.">        if (isPaused) {</span>
<span class="fc" id="L202">            println(&quot;Game Paused&quot;);</span>
        } else {
<span class="fc" id="L204">            println(&quot;Game Resumed&quot;);</span>
            // Adjust startTime to account for the pause duration
<span class="fc" id="L206">            startTime = System.currentTimeMillis() - ((totalTime - remainingTime) * 1000);</span>
        }
<span class="fc" id="L208">    }</span>

    public boolean getIsPaused() {
<span class="fc" id="L211">        return isPaused;</span>
    }

    /**
     * Handle key presses for restarting and pausing the game.
     *
     * @param key the key character that was pressed
     */
    public void handleKeyPress(char key) {
        // If the game is ended, handle restart event
<span class="fc bfc" id="L221" title="All 2 branches covered.">        if (isGameEnded) {</span>
<span class="pc bpc" id="L222" title="3 of 4 branches missed.">            if (key == 'r' || key == 'R') {</span>
<span class="fc" id="L223">                restartGame();</span>
            }
<span class="fc" id="L225">            return;</span>
        }

        // If the level is ended or time is up, allow restarting the level
<span class="fc bfc" id="L229" title="All 4 branches covered.">        if (levelEnded || timerFinished) {</span>
<span class="pc bpc" id="L230" title="3 of 4 branches missed.">            if (key == 'r' || key == 'R') {</span>
<span class="fc" id="L231">                restartLevel();</span>
            }
<span class="fc" id="L233">            return;</span>
        }

        // Handle events when the game is active
<span class="pc bpc" id="L237" title="1 of 4 branches missed.">        if (key == 'r' || key == 'R') {</span>
<span class="fc" id="L238">            restartLevel();</span>
        }

<span class="fc bfc" id="L241" title="All 2 branches covered.">        if (key == ' ') {</span>
<span class="fc" id="L242">            togglePause();</span>
        }
<span class="fc" id="L244">    }</span>

    @Override
    public void keyPressed() {
<span class="fc" id="L248">        handleKeyPress(key);</span>
<span class="fc" id="L249">    }</span>

    /**
     * Handle mouse presses to draw or remove lines.
     *
     * @param mouseX       the x-coordinate of the mouse
     * @param mouseY       the y-coordinate of the mouse
     * @param mouseButton  the mouse button that was pressed
     * @param isCtrlPressed whether the CTRL key is pressed
     */
    public void handleMousePress(int mouseX, int mouseY, int mouseButton, boolean isCtrlPressed) {
<span class="fc bfc" id="L260" title="All 4 branches covered.">        if (mouseY &gt; TOPBAR &amp;&amp; !isGameEnded) {</span>
            // First check for CTRL + left click to remove a line
<span class="fc bfc" id="L262" title="All 4 branches covered.">            if (mouseButton == LEFT &amp;&amp; isCtrlPressed) {</span>
<span class="fc" id="L263">                removeLineAt(mouseX, mouseY);</span>
            }
            // Otherwise, add a new line on left click
<span class="fc bfc" id="L266" title="All 2 branches covered.">            else if (mouseButton == LEFT) {</span>
<span class="fc" id="L267">                PlayerDrawnLine newLine = new PlayerDrawnLine();</span>
<span class="fc" id="L268">                newLine.addPoint(mouseX, mouseY);</span>
<span class="fc" id="L269">                playerLines.add(newLine);</span>
            }
            // Remove a line on right click
<span class="fc bfc" id="L272" title="All 2 branches covered.">            if (mouseButton == RIGHT) {</span>
<span class="fc" id="L273">                removeLineAt(mouseX, mouseY);</span>
            }
        }
<span class="fc" id="L276">    }</span>

    @Override
    public void mousePressed() {
<span class="pc bpc" id="L280" title="3 of 4 branches missed.">        boolean isCtrlPressed = keyPressed &amp;&amp; keyCode == CONTROL;</span>
<span class="fc" id="L281">        handleMousePress(mouseX, mouseY, mouseButton, isCtrlPressed);</span>
<span class="fc" id="L282">    }</span>

    /**
     * Handle mouse dragging to extend a drawn line.
     *
     * @param mouseX      the x-coordinate of the mouse
     * @param mouseY      the y-coordinate of the mouse
     * @param mouseButton the mouse button being pressed
     */
    public void handleMouseDrag(int mouseX, int mouseY, int mouseButton) {
<span class="pc bpc" id="L292" title="1 of 4 branches missed.">        if (mouseY &gt; TOPBAR &amp;&amp; !isGameEnded) {</span>
<span class="pc bpc" id="L293" title="1 of 4 branches missed.">            if (mouseButton == LEFT &amp;&amp; !playerLines.isEmpty()) {</span>
<span class="fc" id="L294">                PlayerDrawnLine currentLine = playerLines.get(playerLines.size() - 1);</span>
<span class="fc" id="L295">                currentLine.addPoint(mouseX, mouseY);</span>
            }
        }
<span class="fc" id="L298">    }</span>

    @Override
    public void mouseDragged() {
<span class="fc" id="L302">        handleMouseDrag(mouseX, mouseY, mouseButton);</span>
<span class="fc" id="L303">    }</span>

    /**
     * Remove a drawn line near the specified position.
     *
     * @param x the x position
     * @param y the y position
     */
    void removeLineAt(float x, float y) {
<span class="fc bfc" id="L312" title="All 2 branches covered.">        for (int i = playerLines.size() - 1; i &gt;= 0; i--) {</span>
<span class="fc" id="L313">            PlayerDrawnLine line = playerLines.get(i);</span>
<span class="fc bfc" id="L314" title="All 2 branches covered.">            if (line.isNear(x, y)) {</span>
<span class="fc" id="L315">                playerLines.remove(i);</span>
<span class="fc" id="L316">                break;</span>
            }
        }
<span class="fc" id="L319">    }</span>

    /**
     * Draw the top bar displaying score, time, and ball spawn countdown.
     */
    public void drawTopBar() {
<span class="fc" id="L325">        fill(0);</span>
<span class="fc" id="L326">        textSize(20);</span>
<span class="fc" id="L327">        textAlign(LEFT, CENTER);</span>

        // Display the score
<span class="fc" id="L330">        text(&quot;Score: &quot; + score, 450, TOPBAR - 45);</span>
<span class="fc" id="L331">        text(&quot;Time: &quot; + remainingTime, 450, TOPBAR - 15);</span>

        // Only show the ball spawn countdown if necessary
<span class="fc bfc" id="L334" title="All 2 branches covered.">        if (!unspawnedBalls.isEmpty()) {</span>
<span class="fc" id="L335">            float timeRemaining = Math.max(spawnCounter / (float) App.FPS, 0);</span>
<span class="fc" id="L336">            text(String.format(&quot;%.1f&quot;, timeRemaining), 192, TOPBAR - 30);</span>
<span class="fc" id="L337">        } else {</span>
<span class="fc" id="L338">            spawnCounter = 0;</span>
        }

        // Display bottom black frame
<span class="fc" id="L342">        fill(0);</span>
<span class="fc" id="L343">        rect(0, 12, 160, 36); // Draw black rectangle at the bottom</span>
<span class="fc" id="L344">    }</span>

    /**
     * Main drawing method that updates and draws game elements.
     */
    @Override
    public void draw() {
<span class="fc" id="L351">        background(200, 200, 200);</span>

        //----------------------------------
        // Render Phase
        //----------------------------------
<span class="fc" id="L356">        render();</span>

        //----------------------------------
        // Update Phase
        //----------------------------------
<span class="pc bpc" id="L361" title="1 of 6 branches missed.">        if (!isPaused &amp;&amp; !isGameEnded &amp;&amp; !levelEnded) {</span>
<span class="fc" id="L362">            updateGame();</span>
        }

        //----------------------------------
        // Final Render Phase
        //----------------------------------
<span class="fc" id="L368">        postRender();</span>
<span class="fc" id="L369">    }</span>

    /**
     * Render game elements.
     */
    void render() {
<span class="fc" id="L375">        drawTopBar();</span>

        // Isolate clipping using push/pop
<span class="fc" id="L378">        pushMatrix();</span>
<span class="fc" id="L379">        pushStyle();</span>
<span class="fc" id="L380">        clip(0, 12, 160, 36); // Define the clipping region</span>

        // Draw unspawned balls, only display at most 5
<span class="fc bfc" id="L383" title="All 2 branches covered.">        for (int i = 0; i &lt; Math.min(5, unspawnedBalls.size()); i++) {</span>
<span class="fc" id="L384">            Ball ball = unspawnedBalls.get(i);</span>

            // Move the unspawned balls to the left by 1 pixel per frame
<span class="fc bfc" id="L387" title="All 2 branches covered.">            if (ball.getX() &gt; 20 + i * 30) {</span>
<span class="fc" id="L388">                ball.setX(ball.getX() - 1);</span>
            }
            // Ensure the ball is within the clipping region
<span class="pc bpc" id="L391" title="4 of 8 branches missed.">            if (ball.getX() &gt;= 0 &amp;&amp; ball.getX() &lt;= 160 &amp;&amp; ball.getY() &gt;= 12 &amp;&amp; ball.getY() &lt;= 48) {</span>
<span class="fc" id="L392">                ball.draw(this);</span>
            }

        }

        // Disable clipping to avoid affecting further drawing
<span class="fc" id="L398">        noClip(); // Disable clipping</span>
<span class="fc" id="L399">        popStyle();</span>
<span class="fc" id="L400">        popMatrix(); // Restore transformation and style states</span>

<span class="pc bpc" id="L402" title="1 of 2 branches missed.">        if (currentLevel != null) {</span>
            // Display pause message if the game is paused
<span class="fc bfc" id="L404" title="All 2 branches covered.">            if (isPaused) {</span>
<span class="fc" id="L405">                fill(0);</span>
<span class="fc" id="L406">                textSize(20);</span>
<span class="fc" id="L407">                textAlign(CENTER, CENTER);</span>
<span class="fc" id="L408">                text(&quot;***PAUSED***&quot;, WIDTH / 2 + 50, TOPBAR / 2);</span>
            }

            // Draw the current level
<span class="fc" id="L412">            currentLevel.draw(this);</span>
        }

        // Draw player-drawn lines
<span class="fc bfc" id="L416" title="All 2 branches covered.">        for (PlayerDrawnLine line : playerLines) {</span>
<span class="fc" id="L417">            line.draw(this);</span>
<span class="fc" id="L418">        }</span>

        // Display game end messages
<span class="pc bpc" id="L421" title="2 of 6 branches missed.">        if (timerFinished &amp;&amp; !(currentLevel.getBalls().isEmpty() &amp;&amp; unspawnedBalls.isEmpty())) {</span>
<span class="fc" id="L422">            fill(0);</span>
<span class="fc" id="L423">            textSize(20);</span>
<span class="fc" id="L424">            textAlign(CENTER, CENTER);</span>
<span class="fc" id="L425">            text(&quot;===TIME’S UP===&quot;, WIDTH / 2 + 50, TOPBAR / 2);</span>
<span class="fc bfc" id="L426" title="All 2 branches covered.">        } else if (isGameEnded) {</span>
<span class="fc" id="L427">            fill(0);</span>
<span class="fc" id="L428">            textSize(20);</span>
<span class="fc" id="L429">            textAlign(CENTER, CENTER);</span>
<span class="fc" id="L430">            text(&quot;===ENDED===&quot;, WIDTH / 2 + 50, TOPBAR / 2);</span>
        }
<span class="fc" id="L432">    }</span>

    /**
     * Update game logic.
     */
    void updateGame() {
        // Update timer
<span class="fc" id="L439">        updateTimer();</span>

        // Update balls and check collisions
<span class="fc" id="L442">        currentLevel.update(this);  // Update balls, check collisions</span>

        // Check for ball collisions with player-drawn lines
<span class="fc bfc" id="L445" title="All 2 branches covered.">        for (Ball ball : currentLevel.getBalls()) {</span>
<span class="fc bfc" id="L446" title="All 2 branches covered.">            for (PlayerDrawnLine line : playerLines) {</span>
<span class="fc" id="L447">                line.checkCollision(ball);</span>
<span class="fc" id="L448">            }</span>
<span class="fc" id="L449">        }</span>

        // Remove inactive balls and add them back to the unspawned queue
<span class="fc" id="L452">        List&lt;Ball&gt; inactiveBalls = new ArrayList&lt;&gt;();</span>
<span class="fc bfc" id="L453" title="All 2 branches covered.">        for (Ball ball : currentLevel.getBalls()) {</span>
<span class="fc bfc" id="L454" title="All 2 branches covered.">            if (!ball.getIsActive()) {</span>
<span class="fc" id="L455">                inactiveBalls.add(ball);</span>
            }
<span class="fc" id="L457">        }</span>
<span class="fc bfc" id="L458" title="All 2 branches covered.">        for (Ball ball : inactiveBalls) {</span>
<span class="fc" id="L459">            currentLevel.removeBall(ball);</span>
<span class="fc" id="L460">            addUnspawnedBall(ball);</span>
<span class="fc" id="L461">        }</span>

        // Update spawn counter and spawn a new ball if ready
<span class="fc bfc" id="L464" title="All 2 branches covered.">        if (spawnCounter &gt; 0) {</span>
<span class="fc" id="L465">            spawnCounter--;</span>
        } else {
<span class="fc" id="L467">            spawnNewBall();</span>
<span class="fc" id="L468">            spawnCounter = configReader.getLevelConfig(currentLevelIndex)</span>
<span class="fc" id="L469">                    .getInt(&quot;spawn_interval&quot;) * App.FPS;</span>
        }

        // Check if the level should end
<span class="fc bfc" id="L473" title="All 4 branches covered.">        if (currentLevel.getBalls().isEmpty() &amp;&amp; unspawnedBalls.isEmpty()) {</span>
<span class="fc" id="L474">            currentLevel.endLevel(this, &quot;normal&quot;);</span>
<span class="fc" id="L475">            levelEnded = true;</span>
<span class="fc" id="L476">            isGameEnded = true;</span>
        }

        // Update all holes to manage attracted balls
<span class="fc bfc" id="L480" title="All 2 branches covered.">        for (Hole hole : currentLevel.getHoles()) {</span>
<span class="fc" id="L481">            hole.updateAttractedBalls();</span>
<span class="fc" id="L482">        }</span>

        // Handle level end due to time up
<span class="pc bpc" id="L485" title="2 of 6 branches missed.">        if (timerFinished &amp;&amp; !(currentLevel.getBalls().isEmpty() &amp;&amp; unspawnedBalls.isEmpty())) {</span>
<span class="fc" id="L486">            currentLevel.endLevel(this, &quot;timeUp&quot;); // End the level only once</span>
<span class="fc" id="L487">            levelEnded = true;  // Mark the level as ended to prevent multiple calls</span>
<span class="fc" id="L488">            isGameEnded = true; // Stop further game updates</span>
        }
<span class="fc" id="L490">    }</span>

    /**
     * Final rendering tasks after game updates.
     */
    void postRender() {
        // Currently, all rendering is handled in render()
        // Additional post-rendering tasks can be added here if necessary
<span class="fc" id="L498">    }</span>

    /**
     * Update the timer based on the elapsed time.
     */
    public void updateTimer() {
<span class="fc bfc" id="L504" title="All 6 branches covered.">        if (timerFinished || (currentLevel != null &amp;&amp; currentLevel.getIsLevelEnded())) return;</span>

<span class="fc bfc" id="L506" title="All 2 branches covered.">        if (!isPaused) {</span>
<span class="fc" id="L507">            long currentTime = System.currentTimeMillis();</span>
<span class="fc" id="L508">            long elapsedTime = (currentTime - startTime) / 1000; // Convert to seconds</span>
<span class="fc" id="L509">            remainingTime = totalTime - (int) elapsedTime;</span>

<span class="fc bfc" id="L511" title="All 2 branches covered.">            if (remainingTime &lt;= -1) {</span>
<span class="fc" id="L512">                remainingTime = 0;</span>
<span class="fc" id="L513">                timerFinished = true;</span>
            }
        }
<span class="fc" id="L516">    }</span>

    /**
     * Gets the remaining time for the current level.
     *
     * @return The remaining time in seconds.
     */
    public int getRemainingTime() {
<span class="fc" id="L524">        return remainingTime;</span>
    }

    /**
     * Sets the remaining time for the level.
     *
     * @param time The new remaining time in seconds.
     */
    public void setRemainingTime(int time) {
<span class="fc" id="L533">        this.remainingTime = time;</span>
<span class="fc" id="L534">    }</span>

    public boolean isTimerFinished() {
<span class="fc" id="L537">        return timerFinished;</span>
    }

    /**
     * Increase the game score by a specified amount.
     *
     * @param amount The amount to increase the score by.
     */
    public void increaseScore(int amount) {
<span class="fc" id="L546">        score += amount;</span>
<span class="fc" id="L547">    }</span>

    /**
     * Decrease the game score by a specified amount.
     * Ensures the score does not fall below zero.
     *
     * @param amount The amount to decrease the score by.
     */
    public void decreaseScore(int amount) {
<span class="fc" id="L556">        score -= amount;</span>
<span class="fc" id="L557">    }</span>

    /**
     * Spawn a new ball immediately, ignoring the timer.
     * Resets the ball position, sets it as active, and re-adds it to the current level.
     *
     * @param ball The ball to spawn immediately.
     */
    public void spawnNewBallImmediate(Ball ball) {
<span class="fc" id="L566">        currentLevel.removeBall(ball);</span>

        // Set the ball to a random spawner position
<span class="fc bfc" id="L569" title="All 2 branches covered.">        if (!currentLevel.getSpawners().isEmpty()) {</span>
<span class="fc" id="L570">            int randomIndex = random.nextInt(currentLevel.getSpawners().size());</span>
<span class="fc" id="L571">            Spawner spawner = currentLevel.getSpawners().get(randomIndex);</span>
<span class="fc" id="L572">            ball.setX(spawner.getX());</span>
<span class="fc" id="L573">            ball.setY(spawner.getY());</span>
        }

        // Set the ball as active and reset its velocity and radius
<span class="fc" id="L577">        ball.setIsActive(true);</span>
<span class="fc" id="L578">        ball.setXVelocity(ball.getRandomVelocity());</span>
<span class="fc" id="L579">        ball.setYVelocity(ball.getRandomVelocity());</span>
<span class="fc" id="L580">        ball.resetRadius();</span>
<span class="fc" id="L581">        currentLevel.addBall(ball);  // Re-add the ball to the current level</span>
<span class="fc" id="L582">    }</span>

    /**
     * Main entry point for the game application.
     *
     * @param args Command-line arguments.
     */
    public static void main(String[] args) {
<span class="fc" id="L590">        PApplet.main(&quot;inkball.App&quot;);</span>
<span class="fc" id="L591">    }</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span></div></body></html>